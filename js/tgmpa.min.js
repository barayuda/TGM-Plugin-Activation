(function($){var _hash,versionNr=$(".version-number"),releaseDate=$(".release-date"),zipUrls,tarUrls,releasesTable,releaseNotes,releases,spinner,publishFieldset,feedbackElm,feedbackMsg,reportError,latestVersion,latestRelease,releasePublished,previousRelease;zipUrls=$(".latest-zip");tarUrls=$(".latest-tar");releasesTable=$("#releases-table");releaseNotes=$("#release-notes");releases=releasesTable.find("tbody");spinner=$("#spinner");publishFieldset=$("#tgmpa-form-publish");feedbackElm=$(".generator-feedback");feedbackMsg=$("#generator-feedback");reportError=$("#report-generator-error");latestVersion="";if(window.location.hash){if("#dependencies"===window.location.hash){window.location.hash="#requirements"}else{if("#download"===window.location.hash||"#installation"===window.location.hash||"#screenshots"===window.location.hash||"#authors"===window.location.hash){_hash=window.location.hash.split("#");window.location.replace(siteurl+"/"+_hash)}}}function compareVersionNumber(a,b){var aVersion,bVersion,aStatus,bStatus;aVersion=getTagFromTagName(a.tag_name);bVersion=getTagFromTagName(b.tag_name);aStatus=getStatusFromTagName(a.tag_name);bStatus=getStatusFromTagName(b.tag_name);if(aVersion<bVersion){return -1}if(aVersion>bVersion){return 1}if(aStatus<bStatus){return -1}if(aStatus>bStatus){return 1}return 0}function getTagFromTagName(tagName){if(tagName.match(/[0-9\.]+/)){return tagName.replace(/^(?:v)?([0-9\.]+)(?:-(?:alpha|beta|rc[0-9-]?))?.*$/i,"$1")}else{return""}}function getVersionFromName(name){if(name.match(/[0-9]+\.[0-9]+\.[0-9]+/)){return name.replace(/^.*?([0-9]+\.[0-9]+\.[0-9]+\-(?:alpha|beta|rc[0-9-]?)).*$/i,"$1")}else{return""}}function getStatusFromTagName(tagName){if(tagName.match(/alpha|beta|rc[0-9-]?/i)){return tagName.replace(/^(?:v)?(?:[0-9\.]+)(?:-(alpha|beta|rc[0-9-]?))?.*$/i,"$1").toLowerCase()}else{return""}}function getReleaseDate(release){var months,releaseDate;months=["January","February","March","April","May","June","July","August","September","October","November","December"];releaseDate="";if(release.name.match(/\([0-9]{4}-[0-9]{2}-[0-9]{2}\)/)){releaseDate=release.name.replace(/^[^\(]+\(([0-9]{4}-[0-9]{2}-[0-9]{2})\).*$/,"$1")}if(""===releaseDate&&release.published_at){releaseDate=release.published_at.substr(0,10)}releaseDate=new Date(releaseDate);return months[releaseDate.getUTCMonth()]+" "+releaseDate.getUTCDate()+", "+releaseDate.getUTCFullYear()}function createReleaseTableRows(nrOfRows){var i,maxRows,releaseDate,tableRows="";ghreleases.reverse();maxRows=Math.min(nrOfRows,ghreleases.length);for(i=0;i<maxRows;i++){releaseDate=getReleaseDate(ghreleases[i]);tableRows+=["<tr><td>",ghreleases[i].tag_name,"</td><td>",releaseDate,'</td><td><a href="',ghreleases[i].zipball_url,'">zipball</a></td><td><a href="',ghreleases[i].tarball_url,'">tarball</a></td></tr>'].join("")}return tableRows}if((ghreleases&&ghreleases.length)&&(zipUrls.length||tarUrls.length||versionNr.length||releases.length)){ghreleases.sort(compareVersionNumber);latestRelease=ghreleases.pop();if(versionNr.length&&latestRelease.name){latestVersion=getVersionFromName(latestRelease.name);if(""===latestVersion&&latestRelease.tag_name){latestVersion=getVersionFromName(latestRelease.tag_name)}if(""!==latestVersion){versionNr.html(latestVersion)}}if(zipUrls.length&&latestRelease.zipball_url){zipUrls.attr("href",latestRelease.zipball_url)}if(tarUrls.length&&latestRelease.tarball_url){tarUrls.attr("href",latestRelease.tarball_url)}if(releaseDate.length){releasePublished=getReleaseDate(latestRelease);if(releasePublished){releaseDate.html(", released at "+releasePublished)}}if(releases.length){releases.html(createReleaseTableRows(5))}if(latestRelease.body.length){marked.setOptions({renderer:new marked.Renderer(),gfm:true,tables:true,breaks:true,pedantic:false,sanitize:true,smartLists:true,smartypants:true});previousRelease=ghreleases.shift();if(previousRelease.body.length){releaseNotes.prepend(marked(previousRelease.body)).prepend("<h5>Version "+previousRelease.name+"</h5>")}releaseNotes.prepend(marked(latestRelease.body)).prepend("<h5>Version "+latestRelease.name+"</h5>");$("#no-release-notes").remove()}else{releaseNotes.remove()}}else{releasesTable.remove();releaseNotes.remove()}function showMessage(text,classname){spinner.hide();feedbackElm.fadeTo(200,1).attr("aria-hidden","false");feedbackMsg.addClass(classname).html(text);if("error"===classname){reportError.fadeTo(0,1).attr("aria-hidden","false")}if("success"===classname){feedbackElm.delay(5000).fadeTo(1200,0).attr("aria-hidden","true")}}function resetMessage(){spinner.show();feedbackElm.fadeTo(0,0).attr("aria-hidden","true");feedbackMsg.removeClass().html("");reportError.fadeTo(0,0).attr("aria-hidden","true")}function validateSlug(slug){return slug.search(/^[a-z0-9_-]+$/i)}function validatePrefix(prefix){return prefix.search(/^[a-z0-9_]+$/i)}function validateName(addonName){return addonName.search(/^[a-z0-9 _-]+$/i)}function validateAddonType(addonType){var valid=new Array("parent-theme","child-theme","plugin");return $.inArray(addonType,valid)}function validatePublishType(publishType){var valid=new Array("wporg","themeforest","other");return $.inArray(publishType,valid)}function reEscape(str){return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function addGeneratorUseIndicator(content,addonName,addonType,publishType){var replacement=" for "+addonType.replace(/-/g," ")+" "+addonName;if("wporg"===publishType){replacement+=" for publication on WordPress.org"}else{if("themeforest"===publishType){replacement+=" for publication on ThemeForest"}}return content.replace(/(\* @version\s+[0-9\.]+)([\r\n]+)/,"$1"+replacement+"$2")}function replaceTextDomain(searchString,replacement,content){var reBracketsA,reBracketsB,reNoBrackets;searchString=reEscape(searchString);searchString=searchString.replace(/\\-/g,"-");replacement="$1"+replacement+"$2";reBracketsA=new RegExp("((?:_[_enx]|_[en]x|_n[x]?_noop|__ngettext_noop|translate_nooped_plural)\\((?:[^\\)]+%s\\)){2}[^\\)]+,\\s+')"+searchString+"('\\s+\\))","g");reBracketsB=new RegExp("((?:_[_enx]|_[en]x|_n[x]?_noop|__ngettext_noop|translate_nooped_plural)\\([^\\)]+?%1\\$s \\(%2\\$d/%3\\$d\\)',\\s+')"+searchString+"('\\s+\\))","g");reNoBrackets=new RegExp("((?:_[_enx]|_[en]x|_n[x]?_noop|__ngettext_noop|translate_nooped_plural)\\((?:\\s+\\/\\* translators: [^*]+)?[^\\)]+,\\s+')"+searchString+"('\\s+\\))","g");content=content.replace(reBracketsA,replacement);content=content.replace(reBracketsB,replacement);content=content.replace(reNoBrackets,replacement);return content}function replaceBundledPluginVariable(content,addonType){var re=/('source'\s+=>\s+)get_stylesheet_directory\(\)([^,]+,)/;if("parent-theme"===addonType){return content.replace(re,"$1get_template_directory()$2")}else{if("plugin"===addonType){return content.replace(re,"$1dirname( __FILE__ )$2")}}return content}function replaceIncludeCall(content,addonType){var searchString="require_once dirname( __FILE__ ) . '/class-";if("parent-theme"===addonType){return content.replace(searchString,"require_once get_template_directory() . '/path/to/class-")}else{if("child-theme"===addonType){return content.replace(searchString,"require_once get_stylesheet_directory() . '/path/to/class-")}}return content}function replaceMenuConfigVariables(content){content=content.replace(/('parent_slug'\s+=>\s+')themes.php(',)/,"$1plugins.php$2");content=content.replace(/('capability'\s+=>\s+')edit_theme_options(',)/,"$1manage_options$2");return content}function removeMenuConfigVariables(content){return content.replace(/(\t)+'parent_slug'[ ]+=> '[^']*',.*\s+'capability'[ ]+=> '[^']*',[ ]+.*[\n\r]*/,"")}function replaceAddAdminMenuFunction(content){var re,replacement;re=/(protected function add_admin_menu\([^\)]*\) \{\s+)(?:[^\}]+\}){3}(\s+})/;replacement="$1$this->page_hook = add_theme_page( $args['page_title'], $args['menu_title'], $args['capability'], $args['menu_slug'], $args['function'] );$2";return content.replace(re,replacement)}function removeLoadTextDomainFunctions(content){var reHookIns,reLoadFunction,reOverloadFunctionA,reOverloadFunctionB,replacement="";reHookIns=/[\t]+\/\*(?:[^\*]+\*)+\/\s+add_action\( 'init', array\( \$this, 'load_textdomain' \)[^)]*\);\s+add_filter\( 'load_textdomain_mofile'[^\r\n]+/;reLoadFunction=/[\t]+\/[\*]{2}(?:[^*]+\*)+\/\s+public function load_textdomain\(\) \{(?:[^\}]+\}){4}/;reOverloadFunctionA=/[\t]+\/[\*]{2}(?:[^*]+\*)+\/\s+public function correct_plugin_mofile\([^\)]*\) \{(?:[^\}]+\}){4}/;reOverloadFunctionB=/[\t]+\/[\*]{2}(?:[^*]+\*)+\/\s+public function overload_textdomain_mofile\([^\)]*\) \{(?:[^\}]+\}){5}/;content=content.replace(reHookIns,replacement);content=content.replace(reLoadFunction,replacement);content=content.replace(reOverloadFunctionA,replacement);content=content.replace(reOverloadFunctionB,replacement);return content}$("#tgmpa-text-domain").on("blur",function(){var prefixElm=$("#tgmpa-prefix"),nameElm=$("#tgmpa-name");if(""===prefixElm.val()){prefixElm.val($(this).val().replace(/[ -]/g,"_"))}if(""===nameElm.val()){nameElm.val($(this).val().replace(/[_-]/g," ").toTitleCase())}});$('input:radio[name="tgmpa-flavor"]').on("change",function(){var value=$(this).val();if("parent-theme"===value||"child-theme"===value){publishFieldset.fadeTo(400,1).attr("aria-hidden","false")}else{publishFieldset.fadeTo(400,0).attr("aria-hidden","true")}});if($('input:radio[name="tgmpa-flavor"]').is(":checked")){$('input:radio[name="tgmpa-flavor"]:checked').trigger("change")}else{publishFieldset.fadeTo(400,0).attr("aria-hidden","true")}$("#generator-form").on("submit",function(event){var tgmpaDir,slug,prefix,addonName,addonType,publishType;event.preventDefault();if("1"!==$('input[name="tgmpa_generate"]').val()){return false}resetMessage();tgmpaDir="TGM-Plugin-Activation-"+latestVersion;if($('input:radio[name="tgmpa-flavor"]').is(":checked")){addonType=$('input:radio[name="tgmpa-flavor"]:checked').val()}slug=$("#tgmpa-text-domain").val();prefix=$("#tgmpa-prefix").val();if("undefined"===typeof prefix||""===prefix){prefix=slug}addonName=$("#tgmpa-name").val();if("undefined"===typeof addonName||""===addonName){addonName=slug.replace(/-/g," ").toTitleCase()}publishType="other";if($('input:radio[name="tgmpa-publish"]').is(":checked")){publishType=$('input:radio[name="tgmpa-publish"]:checked').val()}prefix=prefix.replace(/-/g,"_");if((validateSlug(slug)===-1||validatePrefix(prefix)===-1)||(validateName(addonName)===-1||validateAddonType(addonType)===-1)||validatePublishType(publishType)===-1){showMessage("Invalid input received.","error");return false}JSZipUtils.getBinaryContent("../releases/"+tgmpaDir+".zip",function(err,data){if(err){showMessage("Failed to retrieve TGMPA: "+err,"error");return false}try{JSZip.loadAsync(data).then(function updateContent(zip){var exampleFileContent,classFileContent;exampleFileContent=zip.file(tgmpaDir+"/example.php").async("string").then(function(content){content=replaceTextDomain("theme-slug",slug,content);content=replaceIncludeCall(content,addonType);content=replaceBundledPluginVariable(content,addonType);content=content.replace(/([ '"])my_theme_register_required_plugins(['"\(])/g,"$1"+prefix+"_register_required_plugins$2");content=content.replace(/('id'\s+=>\s+')tgmpa(',)/,"$1"+slug+"$2");if("plugin"===addonType){content=replaceMenuConfigVariables(content)}else{if(("wporg"===publishType||"themeforest"===publishType)&&("parent-theme"===addonType||"child-theme"===addonType)){content=removeMenuConfigVariables(content)}}content=addGeneratorUseIndicator(content,addonName,addonType,publishType);return content});zip.file(tgmpaDir+"/example.php",exampleFileContent);if("other"!==publishType&&("parent-theme"===addonType||"child-theme"===addonType)){classFileContent=zip.file(tgmpaDir+"/class-tgm-plugin-activation.php").async("string").then(function(content){content=replaceAddAdminMenuFunction(content);if("wporg"===publishType){content=removeLoadTextDomainFunctions(content);content=replaceTextDomain("tgmpa",slug,content)}content=addGeneratorUseIndicator(content,addonName,addonType,publishType);return content});zip.file(tgmpaDir+"/class-tgm-plugin-activation.php",classFileContent);if("wporg"===publishType){zip.remove(tgmpaDir+"/languages")}}zip.remove(tgmpaDir+"/.editorconfig");zip.remove(tgmpaDir+"/.jscsrc");zip.remove(tgmpaDir+"/.jshintignore");zip.remove(tgmpaDir+"/.scrutinizer.yml");zip.remove(tgmpaDir+"/.travis.yml");zip.remove(tgmpaDir+"/composer.json");zip.remove(tgmpaDir+"/phpcs.xml");return zip}).then(function serveZip(zip){if(JSZip.support.blob){zip.generateAsync({type:"blob"}).then(function success(blob){saveAs(blob,tgmpaDir+"-"+slug+".zip");showMessage("Custom TGMPA succesfully created!","success")},function failure(error){showMessage("Failed to generate Custom TGMPA file: "+error,"error")})}else{showMessage("This browser is not supported.","warning")}return false})}catch(error){showMessage(" "+error,"error")}});spinner.hide()})})(jQuery);